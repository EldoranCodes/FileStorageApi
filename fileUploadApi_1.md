# File Storage API – Version 1 Roadmap

This document outlines the plan to build a File Upload API in Spring Boot with PostgreSQL, focused on learning and version 1 functionality.

---

## 1. Entities (DB Tables)

### accounts

### `users` (applications)
- `id` (autogenerated, primary key)  
- `name` (application name, e.g., “demo-app”)
- `status` (`ACTIVE` / `INACTIVE`)  
- `accountsId` (`many to one, acocunts.id`)  
- `created_at` (`timestamp`)  
- `api_key` (hashed api key )

### `upload_batches`
- `id` (autogenerated)  
- `created_at` (timestamp)  
- `status` (`PENDING`, `SUCCESS`, `FAILED`)  
- `usersId` (foreign key → users.id)  
- Relationship: **1 batch → many stored_files**  

### `stored_file`
- `id` (autogenerated)  
- `original_name` (file name from client)  
- `uuid` (generated unique identifier)  
- `upload_timestamp`  
- `batch_id` (foreign key → upload_batches.id)  
- `storage_path` (`basePath + relativePath`, e.g., `/var/lib/myappname/users/demo-app/uuid`)  

---

## 2. Main Controllers / Endpoints

| Endpoint | Method | Purpose | Request / Notes | Response |
|----------|--------|---------|-----------------|----------|
| `/upload` | POST | Upload single or multiple files | Header: `Authorization: ApiKey <key>`<br>Multipart: file1, file2 | JSON: batch info + file metadata |
| `/delete/batch/{batchId}` | DELETE | Delete all files in a batch | Path: `batchId` | JSON: success/failure |
| `/delete/file/{fileId}` | DELETE | Delete a single file | Path: `fileId` | JSON: success/failure |
| `/files/{batchId}` | GET | List all files in a batch | Path: `batchId` | JSON: file metadata |

---

## Testing
  - Start with 2 demo users with pre-generated API keys
  - Upload single file → verify DB + disk storage
  - Upload multiple files → verify batch + files
  - Test deletion endpoints
  - Use Postman or curl for requests

## Step 5: Dockerize (optional for learning)
  - Containerize Postgres + Spring Boot app
  - Mount volume for basePath → persistent storage
  - Pass base path and DB connection as environment variables

## Features to Add Later (Scaling & Learning)
  - Multiple API keys per user / rotation
  - Quotas per user / batch
  - File type & size validation
  - Download endpoint
  - Logging & auditing
  - Admin endpoint to generate API keys for new applications
